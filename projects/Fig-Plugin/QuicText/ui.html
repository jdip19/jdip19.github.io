<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src data: blob:; connect-src https://kmkjuuytbgpozrigspgw.supabase.co https://*.supabase.co https://test.checkout.dodopayments.com https://api.dodopayments.com https://*.dodopayments.com; script-src 'unsafe-inline' 'unsafe-eval' data: blob:; style-src 'unsafe-inline' data: blob:; frame-src https://test.checkout.dodopayments.com https://*.dodopayments.com;"
    />
    <title>QuicText Pro</title>
    <style>
      html {
        --primary-color: #fd371f;
        --secondary-color: #ff844b;
        --gradient-primary: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        --gap4: 4px;
        --gap8: 8px;
        --gap12: 12px;
        --gap16: 16px;
        --gap24: 24px;
        --gap32: 32px;

        --black: #1a1a1a;
        --darkblack: #333333;
        --gray: #666666;
        --white: #ffffff;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
        padding: 20px;
        background: #ffffff;
      }

      ::selection {
        background: var(--primary-color);
        color: white;
      }

      .secondary-btn {
        cursor: pointer;
        padding: 12px;
        border-radius: 6px;
        border: 0;
      }

      .secondary-btn:hover {
        background: darkgray;
      }

      .hidden {
        display: none !important;
      }

      /* License UI Styles */
      #freeView {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      div#header {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--gap24);
      }

      .remain {
        display: flex;
        align-items: flex-end;
      }

      #logo {
        display: flex;
        justify-content: center;
        height: 1.8rem;
        position: relative;
        overflow: hidden;
        width: fit-content;
      }

      #logo::after {
        content: "";
        position: absolute;
        top: -50%;
        left: -150%;
        width: 50%;
        height: 200%;
        background: linear-gradient(
          120deg,
          transparent,
          rgba(255, 255, 255, 0.35),
          transparent
        );
        animation: shine 3s ease-in-out infinite;
        pointer-events: none;
      }

      @keyframes shine {
        0% {
          left: -150%;
        }

        60% {
          left: 150%;
        }

        100% {
          left: 150%;
        }
      }

      .battery-col {
        display: flex;
        align-items: center;
      }

      .battery {
        width: 32px;
        height: 100%;
        border: 2px solid #ccc;
        border-radius: 4px;
        position: relative;
        padding: 2px;
        box-sizing: border-box;
        display: flex;
        align-items: flex-end;
        /* fill from bottom */
      }

      /* Battery tip (top) */
      .battery::after {
        content: "";
        position: absolute;
        top: -6px;
        left: 37%;
        width: 8px;
        height: 4px;
        background: #ccc;
        border-radius: 1px;
      }

      .battery-level {
        width: 100%;
        height: 0%;
        background: #4caf50;
        border-radius: 2px;
        transition: height 0.4s ease, background-color 0.3s ease;
      }

      .license-header {
        text-align: center;
      }

      .license-header h2 {
        font-size: 24px;
        font-weight: 700;
        color: var(--black);
      }

      .license-header p {
        font-size: 14px;
        color: #666;
      }

      button#upgradeBtn {
        background: var(--gradient-primary);
        padding: 12px;
      }

      .usage-info {
        display: flex;
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        justify-content: space-between;
      }

      .usage-info .remaining {
        font-size: 32px;
        font-weight: 700;
        color: #1a1a1a;
      }

      .usage-info .limit-text {
        font-size: 14px;
        color: #666;
      }

      .pricing-card {
        background: var(--gradient-primary);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      }

      .pricing-card .price {
        font-size: 48px;
        font-weight: 700;
        margin: 12px 0;
      }

      .pricing-card .price-label {
        font-size: 14px;
        opacity: 0.9;
      }

      .features {
        list-style: none;
        margin: 20px 0;
        text-align: left;
      }

      .features li {
        padding: 8px 0;
        font-size: 14px;
      }

      .features li:before {
        content: "✓ ";
        color: var(--white);
        font-weight: bold;
        margin-right: 8px;
      }

      .input-row {
        display: flex;
        flex-direction: column;
        gap: var(--gap4);
        margin-bottom: var(--gap12);
      }

      .list {
        margin-bottom: var(--gap16);
      }

      input,
      select {
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 14px;
        width: 100%;
        font-family: monospace;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--primary-color);
      }

      select {
        cursor: pointer;
        appearance: none;
        /* Disable the default arrow */
        -webkit-appearance: none;
        /* For WebKit-based browsers */
        -moz-appearance: none;
        /* For Firefox */
        background-image: url('data:image/svg+xml;utf8,<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9L12 15L18 9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/></svg>');
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 18px;
      }

      select option {
        color: var(--black);
        padding: 8px;
      }

      select option:hover {
        background-color: var(--primary-color);
        color: var(--white);
      }

      select option:checked {
        background-color: var(--primary-color);
        color: var(--white);
      }

      label {
        font-size: 13px;
        color: var(--black);
        margin-bottom: 4px;
      }

      .view-title {
        font-size: 20px;
        font-weight: 600;
        border-bottom: 2px solid #e0e0e0;
        padding-bottom: var(--gap8);
        margin-bottom: var(--gap16);
        color: var(--black);
      }

      .license-input {
        margin-bottom: var(--gap16);
      }

      .license-input:focus {
        outline: none;
        border-color: var(--primary-color);
      }

      .action-container {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }

      button#settingsBtn {
        background: transparent;
        border: 0;
        font-size: 20px;
        cursor: pointer;
        transition: rotate 0.2s ease;
      }

      button#settingsBtn:hover {
        rotate: 30deg;
      }

      .activate-btn {
        padding: 12px 24px;
        background: var(--black);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        width: 100%;
      }

      .activate-btn:hover {
        background: var(--darkblack);
      }

      .activate-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .buy-link {
        display: block;
        text-align: center;
        margin-top: 16px;
        color: var(--primary-color);
        text-decoration: none;
        font-size: 14px;
      }

      .buy-link:hover {
        text-decoration: underline;
      }

      .error-message {
        color: #ff6b6b;
        font-size: 12px;
        margin-top: 8px;
        display: none;
      }

      .error-message.show {
        display: block;
      }
    </style>
  </head>

  <body>
    <!-- Settings / Dashboard header -->
    <div id="header">
      <a
        id="logo"
        href="https://www.figma.com/community/plugin/1365014672422582628/quictext"
        target="_blank"
        rel="noopener noreferrer"
      >
        <svg
          viewBox="0 0 1063 244"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clip-path="url(#clip0_346_54)">
            <path
              d="M0 19.9184C0 8.91776 8.91776 0 19.9184 0H224.082C235.082 0 244 8.91776 244 19.9184V224.082C244 235.082 235.082 244 224.082 244H19.9184C8.91776 244 0 235.082 0 224.082V19.9184Z"
              fill="url(#paint0_linear_346_54)"
            />
            <path
              d="M62.9141 51.9419V58.1636H90.0215V51.9419H117.13V58.1636H144.237V51.9419H171.345V58.1636H198.453V51.9419H225.561V58.1636H252.669V51.9419H273.146L272.408 58.8267L270.764 74.1636L264.577 73.5005L261.287 104.172L261.288 104.173L267.474 104.837L264.184 135.51L257.998 134.847L254.708 165.52L260.894 166.184L257.604 196.857L251.418 196.194L248.128 226.867L254.314 227.531L251.024 258.204L244.839 257.541L241.549 288.214L247.735 288.877L246.09 304.214L245.494 309.772H226.351V303.55H199.242V309.772H172.135V303.55H145.027V309.772H117.919V303.55H90.8115V309.772H63.7041V303.55H36.5957V309.772H16.1182L16.8564 302.887L18.501 287.55L24.6865 288.214L27.9766 257.541L21.791 256.877L25.0801 226.204L31.2656 226.867L34.5557 196.193L28.3701 195.531L31.6602 164.857L37.8457 165.52L41.1357 134.847L34.9502 134.183L38.2393 103.51L44.4248 104.172L47.7148 73.5005L41.5293 72.8364L43.1748 57.5005L43.7705 51.9419H62.9141Z"
              stroke="black"
              stroke-opacity="0.1"
              stroke-width="12.4427"
              stroke-dasharray="29.86 29.86"
            />
            <path
              d="M28.5875 35.8472H77.3802L71.4588 76.5868H22.666L28.5875 35.8472Z"
              fill="black"
              fill-opacity="0.1"
            />
            <path
              d="M244.912 34.5425H293.704L287.783 75.2821H238.99L244.912 34.5425Z"
              fill="black"
              fill-opacity="0.1"
            />
            <path
              d="M258.685 86.5303C254.739 100.034 250.792 127.135 247.797 146.915L234.912 147.581C234.912 141.637 234.246 130.416 232.629 124.14C230.3 112.586 224.689 107.974 203.578 107.974H184.464L154.414 266.021C149.802 290.127 151.467 294.406 182.134 296.356L179.472 307.91H72.9187L75.5338 296.356C103.587 294.359 106.249 289.414 110.861 266.021L141.529 107.974H127.693C103.254 107.974 97.3104 111.588 90.4161 120.859C89.1798 122.428 87.9912 124.045 86.8025 125.757C83.0463 131.272 79.5278 137.834 75.2485 146.915L62.3633 146.582C66.3097 132.841 70.0184 119.576 72.9663 107.213C74.678 99.9861 76.1519 93.0918 77.2455 86.5303H86.1368C89.7504 93.4722 92.6983 93.4722 101.59 93.4722H232.582C240.808 93.4722 241.806 92.4737 248.748 86.5303H258.685Z"
              fill="white"
              stroke="white"
              stroke-width="0.460534"
            />
            <path
              d="M158.917 48.9659C158.917 36.0171 169.414 25.52 182.363 25.52H245.7V72.4117H182.363C169.414 72.4117 158.917 61.9147 158.917 48.9659Z"
              fill="url(#paint1_linear_346_54)"
            />
            <path
              d="M175.267 58.4658L178.388 39.6707H185.803C187.222 39.6707 188.388 39.943 189.3 40.4875C190.217 41.0259 190.86 41.7754 191.227 42.7359C191.6 43.6904 191.686 44.7916 191.484 46.0398C191.276 47.294 190.823 48.3983 190.126 49.3528C189.434 50.3011 188.535 51.0414 187.427 51.5737C186.32 52.106 185.041 52.3721 183.591 52.3721H178.865L179.388 49.1876H183.472C184.243 49.1876 184.901 49.056 185.445 48.793C185.996 48.5238 186.433 48.1536 186.757 47.6825C187.082 47.2053 187.293 46.6577 187.391 46.0398C187.495 45.4096 187.461 44.862 187.29 44.397C187.118 43.932 186.803 43.5711 186.344 43.3141C185.892 43.051 185.283 42.9195 184.518 42.9195H181.838L179.241 58.4658H175.267ZM192 58.4658L195.12 39.6707H202.535C203.955 39.6707 205.123 39.9216 206.041 40.4233C206.965 40.9249 207.614 41.6377 207.987 42.5616C208.366 43.4793 208.455 44.5622 208.253 45.8103C208.045 47.0584 207.595 48.1291 206.904 49.0224C206.219 49.9156 205.325 50.6039 204.224 51.0873C203.129 51.5645 201.859 51.8031 200.416 51.8031H195.451L196.001 48.6094H200.315C201.073 48.6094 201.722 48.5054 202.26 48.2974C202.799 48.0894 203.224 47.7773 203.536 47.3613C203.854 46.9453 204.062 46.4283 204.16 45.8103C204.264 45.1802 204.227 44.654 204.05 44.2318C203.872 43.8036 203.551 43.4793 203.086 43.259C202.621 43.0327 202.009 42.9195 201.251 42.9195H198.571L195.974 58.4658H192ZM203.563 49.9126L206.821 58.4658H202.435L199.278 49.9126H203.563ZM227.906 49.3252C227.564 51.332 226.9 53.0359 225.915 54.437C224.936 55.8381 223.74 56.9026 222.326 57.6307C220.919 58.3588 219.402 58.7228 217.774 58.7228C216.067 58.7228 214.596 58.3343 213.36 57.5573C212.13 56.7803 211.24 55.6576 210.69 54.1892C210.139 52.7147 210.035 50.9374 210.377 48.8572C210.708 46.8443 211.366 45.1373 212.351 43.7363C213.336 42.3291 214.538 41.2584 215.957 40.5242C217.377 39.7839 218.903 39.4138 220.537 39.4138C222.232 39.4138 223.694 39.8053 224.924 40.5884C226.159 41.3716 227.05 42.5034 227.594 43.984C228.145 45.4585 228.249 47.2389 227.906 49.3252ZM223.951 48.8572C224.165 47.5663 224.156 46.4833 223.923 45.6084C223.697 44.7274 223.281 44.0605 222.675 43.6078C222.069 43.155 221.305 42.9287 220.381 42.9287C219.377 42.9287 218.457 43.1795 217.618 43.6812C216.786 44.1829 216.083 44.911 215.508 45.8654C214.939 46.8137 214.544 47.967 214.324 49.3252C214.103 50.6223 214.11 51.7052 214.342 52.574C214.581 53.4428 215.006 54.1005 215.618 54.5471C216.236 54.9876 217.004 55.2079 217.921 55.2079C218.918 55.2079 219.83 54.9632 220.656 54.4737C221.488 53.9781 222.189 53.2592 222.758 52.317C223.327 51.3687 223.724 50.2154 223.951 48.8572Z"
              fill="#FE5D34"
            />
          </g>
          <path
            d="M334.869 103.155H351.457L359.796 113.883L368.001 123.44L383.462 142.823H365.251L354.613 129.751L349.158 121.997L334.869 103.155ZM384.859 89.0907C384.859 99.158 382.951 107.723 379.135 114.785C375.348 121.847 370.179 127.241 363.628 130.968C357.107 134.664 349.774 136.512 341.63 136.512C333.426 136.512 326.063 134.649 319.542 130.923C313.021 127.196 307.867 121.802 304.081 114.74C300.294 107.678 298.401 99.128 298.401 89.0907C298.401 79.0234 300.294 70.4587 304.081 63.3966C307.867 56.3345 313.021 50.9552 319.542 47.2589C326.063 43.5325 333.426 41.6693 341.63 41.6693C349.774 41.6693 357.107 43.5325 363.628 47.2589C370.179 50.9552 375.348 56.3345 379.135 63.3966C382.951 70.4587 384.859 79.0234 384.859 89.0907ZM365.07 89.0907C365.07 82.5695 364.094 77.0701 362.14 72.5924C360.217 68.1147 357.497 64.7189 353.981 62.4049C350.465 60.0909 346.348 58.9339 341.63 58.9339C336.912 58.9339 332.795 60.0909 329.279 62.4049C325.763 64.7189 323.028 68.1147 321.075 72.5924C319.152 77.0701 318.19 82.5695 318.19 89.0907C318.19 95.6119 319.152 101.111 321.075 105.589C323.028 110.067 325.763 113.463 329.279 115.777C332.795 118.091 336.912 119.248 341.63 119.248C346.348 119.248 350.465 118.091 353.981 115.777C357.497 113.463 360.217 110.067 362.14 105.589C364.094 101.111 365.07 95.6119 365.07 89.0907ZM443.359 105.769V66.0111H462.562V135.25H444.125V122.673H443.404C441.841 126.73 439.242 129.991 435.605 132.455C431.999 134.919 427.597 136.152 422.398 136.152C417.77 136.152 413.698 135.1 410.182 132.996C406.666 130.893 403.916 127.902 401.933 124.026C399.979 120.149 398.987 115.506 398.957 110.097V66.0111H418.16V106.671C418.19 110.758 419.287 113.988 421.451 116.363C423.615 118.737 426.515 119.924 430.151 119.924C432.465 119.924 434.629 119.398 436.642 118.346C438.656 117.264 440.278 115.671 441.51 113.568C442.773 111.464 443.389 108.865 443.359 105.769ZM477.922 135.25V66.0111H497.125V135.25H477.922ZM487.568 57.0858C484.713 57.0858 482.264 56.1391 480.221 54.2459C478.207 52.3226 477.201 50.0236 477.201 47.3491C477.201 44.7045 478.207 42.4356 480.221 40.5424C482.264 38.6191 484.713 37.6574 487.568 37.6574C490.423 37.6574 492.857 38.6191 494.871 40.5424C496.914 42.4356 497.936 44.7045 497.936 47.3491C497.936 50.0236 496.914 52.3226 494.871 54.2459C492.857 56.1391 490.423 57.0858 487.568 57.0858ZM543.791 136.602C536.699 136.602 530.598 135.1 525.49 132.095C520.411 129.059 516.504 124.852 513.77 119.473C511.065 114.094 509.713 107.903 509.713 100.901C509.713 93.8088 511.08 87.5882 513.815 82.239C516.579 76.8597 520.501 72.6675 525.58 69.6624C530.659 66.6272 536.699 65.1096 543.701 65.1096C549.741 65.1096 555.03 66.2064 559.568 68.4002C564.106 70.594 567.697 73.6743 570.342 77.6411C572.986 81.6079 574.444 86.2659 574.714 91.6151H556.593C556.082 88.1591 554.73 85.3794 552.536 83.2757C550.372 81.1421 547.533 80.0753 544.017 80.0753C541.041 80.0753 538.442 80.8866 536.218 82.5094C534.024 84.1022 532.311 86.4312 531.079 89.4964C529.847 92.5617 529.231 96.2731 529.231 100.631C529.231 105.048 529.832 108.805 531.034 111.9C532.266 114.995 533.994 117.354 536.218 118.977C538.442 120.6 541.041 121.411 544.017 121.411C546.21 121.411 548.179 120.96 549.922 120.059C551.695 119.157 553.152 117.85 554.294 116.137C555.466 114.394 556.232 112.306 556.593 109.871H574.714C574.414 115.161 572.971 119.819 570.387 123.845C567.832 127.842 564.301 130.968 559.794 133.222C555.286 135.475 549.952 136.602 543.791 136.602ZM623.837 66.0111V80.4359H582.141V66.0111H623.837ZM591.607 49.4226H610.81V113.973C610.81 115.747 611.08 117.129 611.621 118.121C612.162 119.082 612.914 119.758 613.875 120.149C614.867 120.54 616.009 120.735 617.301 120.735C618.203 120.735 619.104 120.66 620.006 120.51C620.907 120.329 621.599 120.194 622.079 120.104L625.1 134.394C624.138 134.694 622.786 135.04 621.043 135.43C619.3 135.851 617.181 136.106 614.687 136.197C610.059 136.377 606.002 135.761 602.516 134.348C599.06 132.936 596.37 130.742 594.447 127.767C592.524 124.792 591.577 121.036 591.607 116.498V49.4226ZM667.157 136.602C660.035 136.602 653.904 135.16 648.765 132.275C643.656 129.36 639.72 125.243 636.955 119.924C634.19 114.574 632.808 108.249 632.808 100.946C632.808 93.8239 634.19 87.5731 636.955 82.1939C639.72 76.8147 643.611 72.6225 648.63 69.6173C653.679 66.6121 659.599 65.1096 666.39 65.1096C670.958 65.1096 675.211 65.8458 679.147 67.3183C683.114 68.7608 686.57 70.9396 689.515 73.8546C692.49 76.7696 694.804 80.4359 696.457 84.8535C698.11 89.241 698.936 94.3798 698.936 100.27V105.544H640.471V93.6436H680.86C680.86 90.8788 680.259 88.4296 679.057 86.2959C677.855 84.1623 676.187 82.4944 674.054 81.2923C671.95 80.0602 669.501 79.4442 666.706 79.4442C663.791 79.4442 661.207 80.1203 658.953 81.4726C656.729 82.7949 654.986 84.583 653.724 86.8369C652.462 89.0607 651.815 91.5399 651.785 94.2746V105.589C651.785 109.015 652.416 111.975 653.679 114.469C654.971 116.964 656.789 118.887 659.133 120.239C661.477 121.592 664.257 122.268 667.472 122.268C669.606 122.268 671.559 121.967 673.332 121.366C675.105 120.765 676.623 119.864 677.885 118.662C679.147 117.459 680.109 115.987 680.77 114.244L698.531 115.416C697.629 119.683 695.781 123.41 692.986 126.595C690.221 129.751 686.645 132.215 682.258 133.988C677.9 135.731 672.867 136.602 667.157 136.602ZM726.276 66.0111L738.988 90.2177L752.015 66.0111H771.714L751.654 100.631L772.255 135.25H752.646L738.988 111.314L725.555 135.25H705.72L726.276 100.631L706.442 66.0111H726.276ZM819.947 66.0111V80.4359H778.25V66.0111H819.947ZM787.716 49.4226H806.919V113.973C806.919 115.747 807.19 117.129 807.731 118.121C808.272 119.082 809.023 119.758 809.984 120.149C810.976 120.54 812.118 120.735 813.41 120.735C814.312 120.735 815.213 120.66 816.115 120.51C817.017 120.329 817.708 120.194 818.189 120.104L821.209 134.394C820.247 134.694 818.895 135.04 817.152 135.43C815.409 135.851 813.29 136.106 810.796 136.197C806.168 136.377 802.111 135.761 798.625 134.348C795.169 132.936 792.479 130.742 790.556 127.767C788.633 124.792 787.686 121.036 787.716 116.498V49.4226ZM862.195 135.25V42.9315H898.618C905.62 42.9315 911.585 44.2688 916.514 46.9434C921.442 49.5879 925.199 53.2692 927.783 57.9873C930.398 62.6754 931.705 68.0847 931.705 74.2152C931.705 80.3457 930.383 85.755 927.738 90.4431C925.093 95.1311 921.262 98.7824 916.243 101.397C911.255 104.011 905.214 105.319 898.122 105.319H874.907V89.6767H894.967C898.723 89.6767 901.818 89.0306 904.253 87.7384C906.717 86.4161 908.55 84.598 909.752 82.284C910.984 79.94 911.6 77.2504 911.6 74.2152C911.6 71.1499 910.984 68.4753 909.752 66.1914C908.55 63.8774 906.717 62.0894 904.253 60.8272C901.788 59.535 898.663 58.8889 894.877 58.8889H881.714V135.25H862.195ZM944.022 135.25V66.0111H962.639V78.0918H963.36C964.623 73.7945 966.741 70.5489 969.716 68.3551C972.691 66.1313 976.117 65.0194 979.994 65.0194C980.956 65.0194 981.992 65.0795 983.104 65.1997C984.216 65.3199 985.193 65.4852 986.034 65.6956V82.7348C985.133 82.4644 983.886 82.2239 982.293 82.0136C980.7 81.8032 979.243 81.698 977.92 81.698C975.096 81.698 972.571 82.3141 970.347 83.5462C968.154 84.7483 966.411 86.4312 965.118 88.5949C963.856 90.7586 963.225 93.2529 963.225 96.0777V135.25H944.022ZM1024.02 136.602C1017.02 136.602 1010.97 135.115 1005.86 132.14C1000.78 129.134 996.857 124.957 994.092 119.608C991.327 114.229 989.945 107.993 989.945 100.901C989.945 93.7487 991.327 87.498 994.092 82.1488C996.857 76.7696 1000.78 72.5924 1005.86 69.6173C1010.97 66.6121 1017.02 65.1096 1024.02 65.1096C1031.03 65.1096 1037.07 66.6121 1042.14 69.6173C1047.25 72.5924 1051.19 76.7696 1053.95 82.1488C1056.72 87.498 1058.1 93.7487 1058.1 100.901C1058.1 107.993 1056.72 114.229 1053.95 119.608C1051.19 124.957 1047.25 129.134 1042.14 132.14C1037.07 135.115 1031.03 136.602 1024.02 136.602ZM1024.11 121.727C1027.3 121.727 1029.96 120.825 1032.09 119.022C1034.23 117.189 1035.83 114.695 1036.92 111.539C1038.03 108.384 1038.58 104.793 1038.58 100.766C1038.58 96.7389 1038.03 93.1477 1036.92 89.9923C1035.83 86.8369 1034.23 84.3426 1032.09 82.5094C1029.96 80.6763 1027.3 79.7597 1024.11 79.7597C1020.9 79.7597 1018.19 80.6763 1016 82.5094C1013.84 84.3426 1012.2 86.8369 1011.09 89.9923C1010 93.1477 1009.46 96.7389 1009.46 100.766C1009.46 104.793 1010 108.384 1011.09 111.539C1012.2 114.695 1013.84 117.189 1016 119.022C1018.19 120.825 1020.9 121.727 1024.11 121.727Z"
            fill="black"
          />
          <path
            d="M294.403 218.75L301.212 177.735H305.939L303.455 192.875H303.856C304.283 192.341 304.877 191.66 305.638 190.833C306.399 189.991 307.421 189.244 308.702 188.59C309.984 187.922 311.626 187.588 313.629 187.588C316.219 187.588 318.389 188.236 320.138 189.531C321.9 190.826 323.135 192.662 323.843 195.038C324.564 197.415 324.657 200.219 324.123 203.45C323.589 206.707 322.568 209.531 321.059 211.921C319.564 214.297 317.721 216.14 315.532 217.448C313.355 218.743 310.985 219.391 308.422 219.391C306.446 219.391 304.917 219.064 303.836 218.41C302.768 217.742 301.98 216.988 301.473 216.147C300.979 215.292 300.598 214.584 300.331 214.024H299.77L298.969 218.75H294.403ZM301.613 203.369C301.239 205.693 301.246 207.742 301.633 209.518C302.02 211.28 302.788 212.662 303.936 213.663C305.084 214.651 306.606 215.145 308.502 215.145C310.478 215.145 312.214 214.624 313.709 213.583C315.204 212.528 316.433 211.113 317.394 209.337C318.355 207.548 319.023 205.559 319.397 203.369C319.744 201.206 319.73 199.257 319.357 197.522C318.996 195.773 318.235 194.391 317.074 193.376C315.925 192.348 314.35 191.834 312.347 191.834C310.425 191.834 308.722 192.321 307.24 193.296C305.772 194.257 304.557 195.606 303.596 197.341C302.648 199.064 301.987 201.073 301.613 203.369ZM328.849 230.285C328.048 230.285 327.341 230.219 326.727 230.085C326.126 229.965 325.712 229.845 325.485 229.725L327.407 225.559C328.502 225.853 329.477 225.94 330.331 225.819C331.199 225.713 332.02 225.292 332.795 224.558C333.582 223.837 334.403 222.702 335.258 221.153L336.58 218.75L330.411 187.989H335.338L339.744 212.582H340.064L352.641 187.989H357.968L339.103 223.196C338.222 224.838 337.254 226.18 336.199 227.221C335.144 228.263 334.003 229.03 332.775 229.524C331.546 230.032 330.238 230.285 328.849 230.285ZM392.324 205.933H397.772L402.338 211.941L403.539 213.543L410.349 222.595H404.901L400.415 216.587L399.294 215.065L392.324 205.933ZM413.553 198.563C412.832 202.835 411.45 206.527 409.407 209.638C407.365 212.735 404.868 215.125 401.917 216.807C398.967 218.476 395.769 219.311 392.324 219.311C388.773 219.311 385.749 218.443 383.252 216.707C380.769 214.958 378.993 212.488 377.925 209.297C376.87 206.093 376.703 202.301 377.424 197.922C378.145 193.65 379.527 189.965 381.57 186.867C383.613 183.756 386.116 181.367 389.08 179.698C392.044 178.015 395.262 177.174 398.733 177.174C402.258 177.174 405.255 178.049 407.725 179.798C410.208 181.533 411.977 184.003 413.032 187.208C414.1 190.399 414.274 194.184 413.553 198.563ZM408.827 197.922C409.414 194.424 409.327 191.48 408.566 189.09C407.805 186.7 406.543 184.891 404.781 183.663C403.019 182.435 400.923 181.821 398.493 181.821C395.956 181.821 393.553 182.468 391.283 183.763C389.013 185.045 387.071 186.934 385.455 189.431C383.84 191.914 382.738 194.958 382.151 198.563C381.563 202.061 381.65 205.005 382.411 207.395C383.172 209.785 384.434 211.594 386.196 212.822C387.959 214.05 390.055 214.665 392.485 214.665C395.021 214.665 397.425 214.024 399.694 212.742C401.964 211.447 403.907 209.558 405.522 207.074C407.138 204.578 408.239 201.527 408.827 197.922ZM440.138 206.173L443.183 187.989H447.909L442.782 218.75H438.056L438.937 213.543H438.616C437.655 215.105 436.313 216.434 434.591 217.528C432.869 218.61 430.846 219.151 428.523 219.151C426.6 219.151 424.958 218.73 423.596 217.889C422.248 217.034 421.287 215.753 420.712 214.044C420.152 212.321 420.085 210.152 420.512 207.535L423.797 187.989H428.523L425.319 207.215C424.958 209.458 425.299 211.247 426.34 212.582C427.381 213.917 428.883 214.584 430.846 214.584C432.021 214.584 433.263 214.284 434.571 213.683C435.893 213.082 437.068 212.161 438.096 210.92C439.137 209.678 439.818 208.096 440.138 206.173ZM451.439 218.75L456.565 187.989H461.292L456.165 218.75H451.439ZM460.371 182.782C459.449 182.782 458.655 182.468 457.987 181.841C457.333 181.213 457.006 180.459 457.006 179.578C457.006 178.696 457.333 177.942 457.987 177.314C458.655 176.687 459.449 176.373 460.371 176.373C461.292 176.373 462.08 176.687 462.734 177.314C463.401 177.942 463.735 178.696 463.735 179.578C463.735 180.459 463.401 181.213 462.734 181.841C462.08 182.468 461.292 182.782 460.371 182.782ZM477.238 219.391C474.341 219.391 471.964 218.71 470.109 217.348C468.266 215.986 466.984 214.11 466.263 211.721C465.543 209.331 465.436 206.6 465.943 203.53C466.45 200.405 467.478 197.648 469.027 195.259C470.576 192.855 472.505 190.979 474.815 189.631C477.125 188.269 479.668 187.588 482.445 187.588C484.608 187.588 486.491 187.989 488.093 188.79C489.695 189.591 490.93 190.712 491.798 192.154C492.666 193.596 493.073 195.279 493.019 197.201H488.293C488.159 195.799 487.559 194.558 486.491 193.476C485.436 192.381 483.874 191.834 481.804 191.834C479.962 191.834 478.266 192.315 476.717 193.276C475.169 194.224 473.867 195.566 472.812 197.301C471.757 199.024 471.043 201.046 470.669 203.369C470.269 205.746 470.302 207.815 470.77 209.578C471.237 211.34 472.085 212.709 473.313 213.683C474.541 214.658 476.09 215.145 477.959 215.145C479.187 215.145 480.336 214.932 481.404 214.504C482.472 214.077 483.42 213.463 484.248 212.662C485.075 211.861 485.73 210.899 486.21 209.778H490.937C490.349 211.594 489.408 213.229 488.113 214.685C486.818 216.126 485.249 217.275 483.406 218.129C481.564 218.97 479.508 219.391 477.238 219.391ZM507.859 177.735L501.05 218.75H496.324L503.133 177.735H507.859ZM518.679 219.471C516.729 219.471 515.02 219.104 513.552 218.369C512.083 217.622 510.995 216.547 510.287 215.145C509.58 213.73 509.386 212.021 509.707 210.018C510.014 208.256 510.608 206.827 511.489 205.733C512.37 204.624 513.438 203.757 514.693 203.129C515.962 202.488 517.324 202.014 518.779 201.707C520.247 201.387 521.709 201.14 523.165 200.966C525.061 200.726 526.603 200.539 527.791 200.405C528.979 200.272 529.874 200.052 530.474 199.745C531.075 199.437 531.442 198.91 531.576 198.162V198.002C531.896 196.04 531.636 194.511 530.795 193.416C529.954 192.308 528.452 191.754 526.289 191.754C524.046 191.754 522.17 192.248 520.661 193.236C519.153 194.224 518.038 195.279 517.317 196.4L513.151 194.798C514.246 192.929 515.555 191.473 517.077 190.432C518.599 189.377 520.194 188.643 521.863 188.229C523.532 187.802 525.141 187.588 526.689 187.588C527.677 187.588 528.792 187.708 530.034 187.949C531.276 188.176 532.437 188.65 533.519 189.371C534.613 190.092 535.434 191.18 535.982 192.635C536.543 194.09 536.623 196.04 536.222 198.483L532.858 218.75H528.131L528.852 214.584H528.612C528.185 215.252 527.531 215.966 526.649 216.727C525.782 217.488 524.68 218.136 523.345 218.67C522.023 219.204 520.468 219.471 518.679 219.471ZM520.041 215.225C521.91 215.225 523.545 214.858 524.947 214.124C526.362 213.389 527.497 212.442 528.352 211.28C529.219 210.118 529.76 208.897 529.974 207.615L530.695 203.289C530.454 203.53 529.98 203.75 529.273 203.95C528.565 204.137 527.764 204.304 526.87 204.451C525.988 204.584 525.127 204.705 524.286 204.811C523.458 204.905 522.791 204.985 522.284 205.052C521.029 205.212 519.834 205.472 518.699 205.833C517.577 206.18 516.629 206.707 515.855 207.415C515.094 208.109 514.62 209.057 514.433 210.259C514.153 211.901 514.546 213.142 515.615 213.984C516.683 214.811 518.158 215.225 520.041 215.225ZM542.125 218.75L548.934 177.735H553.661L551.177 192.875H551.578C552.005 192.341 552.599 191.66 553.36 190.833C554.121 189.991 555.143 189.244 556.424 188.59C557.706 187.922 559.348 187.588 561.351 187.588C563.941 187.588 566.111 188.236 567.86 189.531C569.622 190.826 570.857 192.662 571.565 195.038C572.286 197.415 572.379 200.219 571.845 203.45C571.311 206.707 570.289 209.531 568.781 211.921C567.285 214.297 565.443 216.14 563.253 217.448C561.077 218.743 558.707 219.391 556.144 219.391C554.168 219.391 552.639 219.064 551.558 218.41C550.49 217.742 549.702 216.988 549.195 216.147C548.701 215.292 548.32 214.584 548.053 214.024H547.492L546.691 218.75H542.125ZM549.335 203.369C548.961 205.693 548.968 207.742 549.355 209.518C549.742 211.28 550.51 212.662 551.658 213.663C552.806 214.651 554.328 215.145 556.224 215.145C558.2 215.145 559.936 214.624 561.431 213.583C562.926 212.528 564.155 211.113 565.116 209.337C566.077 207.548 566.745 205.559 567.119 203.369C567.466 201.206 567.452 199.257 567.079 197.522C566.718 195.773 565.957 194.391 564.795 193.376C563.647 192.348 562.072 191.834 560.069 191.834C558.147 191.834 556.444 192.321 554.962 193.296C553.494 194.257 552.279 195.606 551.317 197.341C550.369 199.064 549.709 201.073 549.335 203.369Z"
            fill="black"
          />
          <rect x="599" y="195.75" width="464" height="4" fill="black" />
          <defs>
            <linearGradient
              id="paint0_linear_346_54"
              x1="-149.789"
              y1="51.0593"
              x2="84.242"
              y2="410.003"
              gradientUnits="userSpaceOnUse"
            >
              <stop stop-color="#FD371F" />
              <stop offset="1" stop-color="#FF844B" />
            </linearGradient>
            <linearGradient
              id="paint1_linear_346_54"
              x1="158.917"
              y1="48.9659"
              x2="268.322"
              y2="38.4752"
              gradientUnits="userSpaceOnUse"
            >
              <stop stop-color="white" />
              <stop offset="1" stop-color="white" stop-opacity="0" />
            </linearGradient>
            <clipPath id="clip0_346_54">
              <path
                d="M0 19.9184C0 8.91776 8.91776 0 19.9184 0H224.082C235.082 0 244 8.91776 244 19.9184V224.082C244 235.082 235.082 244 224.082 244H19.9184C8.91776 244 0 235.082 0 224.082V19.9184Z"
                fill="white"
              />
            </clipPath>
          </defs>
        </svg>
      </a>
      <div id="header-actions">
        <button id="settingsBtn" title="Settings">⚙️</button>
      </div>
    </div>

    <!-- Settings Box -->
    <div id="settingsBox" class="hidden">
      <div class="view-header">
        <h3 class="view-title">Settings</h3>
      </div>
      <div class="container">
        <div class="list">
          <div class="input-row">
            <label>Prefix</label>
            <input id="defaultPrefix" />
          </div>
          <div class="input-row">
            <label>Between (used to join words)</label>
            <input id="defaultBetween" />
          </div>
          <div class="input-row">
            <label>Suffix</label>
            <input id="defaultSuffix" />
          </div>
          <div class="input-row">
            <label>Date Format</label>
            <select id="defaultDateFormat">
              <option value="mm-dd-yyyy">01-09-2026</option>
              <option value="dd-mm-yyyy">09-01-2026</option>
              <option value="yyyy-mm-dd">2026-01-09</option>
              <option value="dd MMMM yyyy">09 January 2026</option>
              <option value="dd MMM yyyy">09 Jan 2026</option>
              <option value="dddd, dd MMMM yyyy">
                Thursday, 09 January 2026
              </option>
            </select>
          </div>
        </div>
        <div class="action-container">
          <button id="saveDefaults" class="activate-btn">Save defaults</button>
          <button id="cancelDefaults" class="secondary-btn">Cancel</button>
        </div>
        <p
          id="settingsHint"
          style="font-size: 12px; color: #888; margin-top: 8px"
        >
          Changes are preview only. Upgrade to save defaults.
        </p>
        <div
          id="defaultsSavedMsg"
          style="display: none; margin-top: 8px; color: var(--primary-color)"
        >
          Defaults saved
        </div>
      </div>
    </div>

    <!-- Upgrade Prompt View (Now Independent) -->
    <div
      id="purchasePrompt"
      class="hidden"
      style="text-align: center; padding: 20px"
    >
      <h3 class="view-title">Pro Feature</h3>
      <p style="margin-bottom: 16px">
        Saving custom defaults is a Pro feature. Upgrade to unlock unlimited
        customization!
      </p>
      <button
        id="upgradeBtn"
        class="activate-btn"
        style="padding: 12px 24px; font-size: 16px"
      >
        Upgrade to Pro - $<span id="upgradePrice">--</span>
      </button>
      <div class="row">
        <button
          id="upgradeBackBtn"
          class="secondary-btn"
          style="margin-top: 12px; width: 100%"
        >
          Back to Settings
        </button>
        <button
          id="upgradeHomeBtn"
          class="secondary-btn"
          style="margin-top: 12px; width: 100%"
        >
          Back to Dashboard
        </button>
      </div>
    </div>

    <!-- Pro Dashboard -->
    <div id="proDashboard" class="hidden">
      <h2>Pro Dashboard</h2>
      <div style="margin-top: 12px">
        <div><strong>Email:</strong> <span id="proEmail">—</span></div>
        <div><strong>Plan:</strong> <span id="proPlan">—</span></div>
        <div>
          <strong>License key:</strong>
          <input
            id="proKey"
            disabled
            style="
              width: 100%;
              margin-top: 6px;
              padding: 8px;
              border-radius: 6px;
              border: 1px solid #e0e0e0;
              font-family: monospace;
            "
          />
        </div>
        <div style="margin-top: 8px">
          <strong>Activated:</strong> <span id="proActivated">—</span>
        </div>
        <div style="margin-top: 12px">
          <strong>Usage:</strong> <span id="proUsage">Unlimited</span>
        </div>
        <div style="display: flex; gap: 8px; margin-top: 16px">
          <button
            id="supportBtn"
            class="activate-btn"
            style="background: #6c63ff"
          >
            Support
          </button>
          <button id="logoutBtn" class="secondary-btn">Logout</button>
        </div>
      </div>
    </div>

    <!-- FreeView -->
    <div id="freeView" class="">
      <div class="usage-info">
        <div class="col">
          <div class="remain">
            <div class="remaining" id="remainingCount">0</div>
            /10
          </div>
          <div class="limit-text">Reset in every 24 hours</div>
        </div>
        <div class="col battery-col">
          <div class="battery">
            <div class="battery-level" id="batteryLevel"></div>
          </div>
        </div>
      </div>

      <div class="coomand-counter">
        <div class="col">254,000+ commands generated so far</div>
      </div>

      <div class="pricing-card">
        <div class="price-label">Upgrade to Pro</div>
        <div class="price">$<span id="price"></span></div>
        <ul class="features">
          <li>Unlimited commands forever</li>
          <li>All premium features</li>
          <li>Priority support</li>
          <li>No recurring fees</li>
        </ul>
      </div>

      <div>
        <input
          type="text"
          id="licenseKeyInput"
          class="license-input"
          placeholder="Enter your license key"
          autocomplete="off"
        />
        <div class="error-message" id="errorMessage"></div>
        <button id="activateLicense" class="activate-btn">
          Activate License
        </button>
        <a href="#" id="buyLink" class="buy-link" target="_blank"
          >Don't have a key? Purchase here →</a
        >
      </div>
    </div>

    <script>
      // ============================================================================
      // CONFIGURATION
      // ============================================================================
      const CONFIG = {
        dodopayments: {
          checkoutUrl:
            "https://checkout.dodopayments.com/buy/pdt_SEP94Xh88Gqpram39DT5X",
        },
        views: {
          FREEVIEW: "freeView",
          SETTINGS: "settingsBox",
          PRO_DASHBOARD: "proDashboard",
          UPGRADE_PROMPT: "purchasePrompt",
        },
      };

      // ============================================================================
      // FUNCTIONS
      // ============================================================================
      function updateBattery(remaining, max = 10) {
        const levelEl = document.getElementById("batteryLevel");
        if (!levelEl) return;

        const percent = Math.max(0, Math.min(100, (remaining / max) * 100));
        levelEl.style.height = percent + "%";

        if (remaining >= 7) {
          levelEl.style.background = "#FD371F"; // green
        } else if (remaining >= 4) {
          levelEl.style.background = "#ff9800"; // orange
        } else {
          levelEl.style.background = "#f44336"; // red
        }
      }

      // ============================================================================
      // STATE MANAGEMENT
      // ============================================================================
      class AppState {
        constructor() {
          this.state = {
            isPro: false,
            price: null,
            remaining: 0,
            currentView: CONFIG.views.FREEVIEW,
            licenseData: null,
            defaults: {
              prefix: "",
              between: "",
              suffix: "",
              dateFormat: "mm-dd-yyyy",
            },
            isProcessing: false,
          };
          this.listeners = [];
        }

        get(key) {
          return key ? this.state[key] : this.state;
        }

        set(updates) {
          this.state = { ...this.state, ...updates };
          this.notify();
        }

        subscribe(listener) {
          this.listeners.push(listener);
          return () => {
            this.listeners = this.listeners.filter((l) => l !== listener);
          };
        }

        notify() {
          this.listeners.forEach((listener) => listener(this.state));
        }
      }

      const appState = new AppState();

      // ============================================================================
      // DOM UTILITIES
      // ============================================================================
      class DOMHelper {
        static getElement(id) {
          const el = document.getElementById(id);
          if (!el) console.warn(`Element not found: ${id}`);
          return el;
        }

        static show(id) {
          const el = this.getElement(id);
          if (el) el.classList.remove("hidden");
        }

        static hide(id) {
          const el = this.getElement(id);
          if (el) el.classList.add("hidden");
        }

        static toggle(id, show) {
          show ? this.show(id) : this.hide(id);
        }

        static setText(id, text) {
          const el = this.getElement(id);
          if (el) el.textContent = text;
        }

        static setValue(id, value) {
          const el = this.getElement(id);
          if (el) el.value = value;
        }

        static getValue(id) {
          const el = this.getElement(id);
          return el ? el.value : "";
        }

        static hideAll(ids) {
          ids.forEach((id) => this.hide(id));
        }
      }

      // ============================================================================
      // MESSAGE SERVICE
      // ============================================================================
      class MessageService {
        static post(message) {
          parent.postMessage({ pluginMessage: message }, "*");
        }

        static activateLicense(licenseKey) {
          this.post({ type: "activate-license", licenseKey });
        }

        static saveDefaults(defaults) {
          this.post({ type: "save-defaults", defaults });
        }

        static requestDefaults() {
          this.post({ type: "request-defaults" });
        }

        static logout() {
          this.post({ type: "logout" });
        }
      }

      // ============================================================================
      // UTILITY FUNCTIONS
      // ============================================================================
      class Utils {
        static maskKey(key) {
          if (!key) return "";
          if (key.length <= 8) return key.replace(/.(?=.{4})/g, "*");
          const first = key.slice(0, 4);
          const last = key.slice(-4);
          return `${first}****${last}`;
        }

        static formatDate(d) {
          if (!d) return "—";
          const date =
            typeof d === "number" || !isNaN(Date.parse(d)) ? new Date(d) : null;
          if (!date) return String(d);
          return date.toLocaleString();
        }

        static getCheckoutUrl() {
          const params = new URLSearchParams({
            quantity: "1",
            redirect_url: "https://jdip.vercel.app/payment",
            showDiscounts: "false",
          });
          return `${CONFIG.dodopayments.checkoutUrl}?${params.toString()}`;
        }

        static openCheckout() {
          window.open(
            this.getCheckoutUrl(),
            "dodo_checkout",
            "width=600,height=800"
          );
        }
      }

      // ============================================================================
      // VIEW MANAGERS
      // ============================================================================
      class BaseView {
        constructor(viewId) {
          this.viewId = viewId;
        }

        show() {
          DOMHelper.show(this.viewId);
        }

        hide() {
          DOMHelper.hide(this.viewId);
        }

        render(data) {
          // Override in subclasses
        }
      }

      class LicenseView extends BaseView {
        constructor() {
          super(CONFIG.views.FREEVIEW);
        }

        render(data) {
          const { remaining = 0, price = "--" } = data;

          DOMHelper.setText("remainingCount", remaining);
          DOMHelper.setText("price", price);
          DOMHelper.setText("upgradePrice", price);

          updateBattery(remaining, 10);

          const msgEl = DOMHelper.getElement("limitMessage");
          if (msgEl) {
            msgEl.textContent =
              remaining > 0
                ? `You have ${remaining} free commands left today`
                : `You've reached your daily limit`;
          }
        }

        setupEventListeners() {
          // Activate License Button
          const activateBtn = DOMHelper.getElement("activateLicense");
          if (activateBtn) {
            activateBtn.addEventListener("click", () => this.handleActivate());
          }

          // License Key Input - Enter to submit
          const keyInput = DOMHelper.getElement("licenseKeyInput");
          if (keyInput) {
            keyInput.addEventListener("keypress", (e) => {
              if (e.key === "Enter") this.handleActivate();
            });

            keyInput.addEventListener("input", () => {
              DOMHelper.hide("errorMessage");
            });
          }

          // Buy Link
          const buyLink = DOMHelper.getElement("buyLink");
          if (buyLink) {
            buyLink.href = Utils.getCheckoutUrl();
            buyLink.addEventListener("click", (e) => {
              e.preventDefault();
              Utils.openCheckout();
            });
          }

          // Upgrade Button
          const upgradeBtn = DOMHelper.getElement("upgradeBtn");
          if (upgradeBtn) {
            upgradeBtn.addEventListener("click", () => Utils.openCheckout());
          }
        }

        handleActivate() {
          const licenseKey = DOMHelper.getValue("licenseKeyInput").trim();
          const state = appState.get();

          if (!licenseKey) {
            this.showError("Please enter a license key");
            return;
          }

          if (state.isProcessing) {
            console.warn("Already processing");
            return;
          }

          appState.set({ isProcessing: true });
          this.updateButtonState(true);
          MessageService.activateLicense(licenseKey);
        }

        showError(message) {
          const errorEl = DOMHelper.getElement("errorMessage");
          if (errorEl) {
            errorEl.textContent = message;
            errorEl.classList.add("show");
          }
        }

        updateButtonState(processing) {
          const btn = DOMHelper.getElement("activateLicense");
          if (btn) {
            btn.disabled = processing;
            btn.textContent = processing ? "Validating..." : "Activate License";
          }
        }

        resetForm() {
          DOMHelper.setValue("licenseKeyInput", "");
          const errorEl = DOMHelper.getElement("errorMessage");
          if (errorEl) errorEl.classList.remove("show");
        }
      }

      class SettingsView extends BaseView {
        constructor() {
          super(CONFIG.views.SETTINGS);
        }

        render(data) {
          const defaults = data?.defaults || appState.get("defaults");

          DOMHelper.setValue("defaultPrefix", defaults.prefix || "");
          DOMHelper.setValue("defaultBetween", defaults.between || "");
          DOMHelper.setValue("defaultSuffix", defaults.suffix || "");
          DOMHelper.setValue(
            "defaultDateFormat",
            defaults.dateFormat || "mm-dd-yyyy"
          );

          this.updateHint();
        }

        updateHint() {
          const isPro = appState.get("isPro");
          const hint = DOMHelper.getElement("settingsHint");
          if (hint) {
            hint.style.display = isPro ? "none" : "block";
          }
        }

        setupEventListeners() {
          
          // Save Defaults

          const saveBtn = DOMHelper.getElement("saveDefaults");
          if (saveBtn) {
            saveBtn.addEventListener("click", () => this.handleSave());
          }
          // Cancel
          const cancelBtn = DOMHelper.getElement("cancelDefaults");
          if (cancelBtn) {
            cancelBtn.addEventListener("click", () => {
              const isPro = appState.get("isPro");
              ViewManager.switchView(
                isPro ? CONFIG.views.PRO_DASHBOARD : CONFIG.views.FREEVIEW
              );
            });
          }

          // Upgrade button in purchase prompt
          const upgradeBtn = DOMHelper.getElement("upgradeBtn");
          if (upgradeBtn) {
            upgradeBtn.addEventListener("click", () => Utils.openCheckout());
          }
        }

        handleSave() {
          if (!isPro) {
            // Switch to upgrade prompt view instead of showing inline
            ViewManager.switchView(CONFIG.views.UPGRADE_PROMPT);
            return;
          }

          const defaults = {
            prefix: DOMHelper.getValue("defaultPrefix"),
            between: DOMHelper.getValue("defaultBetween"),
            suffix: DOMHelper.getValue("defaultSuffix"),
            dateFormat: DOMHelper.getValue("defaultDateFormat"),
          };

          appState.set({ defaults });
          MessageService.saveDefaults(defaults);
          this.showSavedMessage();
        }

        showSavedMessage() {
          const msg = DOMHelper.getElement("defaultsSavedMsg");
          if (msg) {
            msg.style.display = "block";
            setTimeout(() => {
              msg.style.display = "none";
            }, 1800);
          }
        }
      }

      class ProDashboardView extends BaseView {
        constructor() {
          super(CONFIG.views.PRO_DASHBOARD);
        }

        render(licenseData) {
          if (!licenseData) return;

          DOMHelper.setText("proEmail", licenseData.email || "—");
          DOMHelper.setText("proPlan", licenseData.plan || "Pro");
          DOMHelper.setValue("proKey", Utils.maskKey(licenseData.key || ""));
          DOMHelper.setText(
            "proActivated",
            Utils.formatDate(licenseData.activatedAt)
          );
          DOMHelper.setText(
            "proUsage",
            licenseData.unlimited ? "Unlimited" : "—"
          );
        }

        setupEventListeners() {
          // Support Button
          const supportBtn = DOMHelper.getElement("supportBtn");
          if (supportBtn) {
            supportBtn.addEventListener("click", () => {
              window.open("https://jdip19.github.io", "_blank", "noopener");
            });
          }

          // Logout Button
          const logoutBtn = DOMHelper.getElement("logoutBtn");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", () => this.handleLogout());
          }
        }

        handleLogout() {
          MessageService.logout();
          appState.set({
            isPro: false,
            licenseData: null,
          });
          ViewManager.switchView(CONFIG.views.FREEVIEW);
        }
      }

      class UpgradePromptView extends BaseView {
        constructor() {
          super(CONFIG.views.UPGRADE_PROMPT);
        }

        render(data) {
          const price = data?.price || appState.get("price") || "--";
          DOMHelper.setText("upgradePrice", price);
        }

        setupEventListeners() {
          // Upgrade button
          const upgradeBtn = DOMHelper.getElement("upgradeBtn");
          if (upgradeBtn) {
            upgradeBtn.addEventListener("click", () => Utils.openCheckout());
          }

          const backBtn = DOMHelper.getElement("backBtn");
          if (backBtn) {
            backBtn.addEventListener("click", () => {
              ViewManager.switchView(
                isPro ? CONFIG.views.PRO_DASHBOARD : CONFIG.views.FREEVIEW
              );
            });
          }

          const homeBtn = DOMHelper.getElement("homeBtn");
          if (homeBtn) {
            homeBtn.addEventListener("click", () => {
              ViewManager.switchView(CONFIG.views.FREEVIEW);
            });
          }
        }
      }

      // ============================================================================
      // VIEW MANAGER
      // ============================================================================
      class ViewManager {
        static views = {
          [CONFIG.views.FREEVIEW]: new LicenseView(),
          [CONFIG.views.SETTINGS]: new SettingsView(),
          [CONFIG.views.PRO_DASHBOARD]: new ProDashboardView(),
          [CONFIG.views.UPGRADE_PROMPT]: new UpgradePromptView(),
        };

        static init() {
          Object.values(this.views).forEach((view) => {
            if (view.setupEventListeners) {
              view.setupEventListeners();
            }
          });

          this.setupGlobalListeners();
        }

        static switchView(viewId, data = null) {
          // Hide all views
          Object.keys(this.views).forEach((id) => {
            DOMHelper.hide(id);
          });

          // Show and render target view
          const view = this.views[viewId];
          if (view) {
            view.show();
            if (data && view.render) {
              view.render(data);
            }
            appState.set({ currentView: viewId });
          }
        }

        static setupGlobalListeners() {
          // Settings Button
          const settingsBtn = DOMHelper.getElement("settingsBtn");
          if (settingsBtn) {
            settingsBtn.addEventListener("click", () => {
              MessageService.requestDefaults();
              this.switchView(CONFIG.views.SETTINGS);
            });
          }
        }

        static handleMessage(msg) {
          if (!msg || typeof msg !== "object") return;

          switch (msg.type) {
            case "show-license":
              this.handleShowLicense(msg);
              break;

            case "license-activated":
              this.handleLicenseActivated();
              break;

            case "license-error":
              this.handleLicenseError(msg);
              break;

            case "current-defaults":
              this.handleCurrentDefaults(msg);
              break;

            case "date-format":
              DOMHelper.setValue("defaultDateFormat", msg.value);
              break;

            case "defaults-saved":
              this.views[CONFIG.views.SETTINGS].showSavedMessage();
              break;

            case "usage-info":
              // console.log("Usage info:", msg);
              break;
          }
        }

        static handleShowLicense(msg) {
          appState.set({
            isPro: msg.isPro,
            price: msg.price,
            remaining: msg.remaining,
            licenseData: msg.licenseData,
          });

          if (msg.isPro && msg.licenseData) {
            this.switchView(CONFIG.views.PRO_DASHBOARD, msg.licenseData);
          } else {
            this.switchView(CONFIG.views.FREEVIEW, {
              remaining: msg.remaining,
              price: msg.price,
            });
          }
        }

        static handleLicenseActivated() {
          const licenseView = this.views[CONFIG.views.FREEVIEW];
          licenseView.resetForm();
          licenseView.updateButtonState(false);
          appState.set({ isProcessing: false });
        }

        static handleLicenseError(msg) {
          const licenseView = this.views[CONFIG.views.FREEVIEW];
          licenseView.showError(msg.message || "Invalid license key");
          licenseView.updateButtonState(false);
          appState.set({ isProcessing: false });
        }

        static handleCurrentDefaults(msg) {
          const defaults = msg.defaults || {};
          appState.set({ defaults });
          this.views[CONFIG.views.SETTINGS].render({ defaults });
        }
      }

      // ============================================================================
      // APPLICATION INITIALIZATION
      // ============================================================================
      class App {
        static init() {
          // Initialize view manager
          ViewManager.init();

          // Subscribe to state changes
          appState.subscribe((state) => {
            // console.log("State updated:", state);
          });

          // Setup message handler
          window.onmessage = (event) => {
            try {
              const msg = event.data?.pluginMessage;
              ViewManager.handleMessage(msg);
            } catch (err) {
              console.error("Error in onmessage handler:", err);
            }
          };

          // Initial focus
          window.addEventListener("load", () => {
            const input = DOMHelper.getElement("licenseKeyInput");
            if (input && !input.classList.contains("hidden")) {
              setTimeout(() => input.focus(), 100);
            }
          });
        }
      }

      // ============================================================================
      // START APPLICATION
      // ============================================================================
      document.addEventListener("DOMContentLoaded", () => {
        App.init();
      });
    </script>
  </body>
</html>
